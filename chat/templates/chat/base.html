<!DOCTYPE HTML>

	<head>
	{% block htmlhead %}
	
		<title>Freespeech</title>

        <meta charset="iso-8859-1">		

		{% load staticfiles %}
        
        <link rel="stylesheet" href="{% static 'chat/css/bootstrap.min.css' %}" />
        <link rel="stylesheet" href="{% static 'chat/css/bootstrap-switch.min.css' %}" />
        <link rel="stylesheet" href="{% static 'chat/generated/css/style.css' %}" />
        <link rel="icon" type="image/png" href="{% static 'chat/images/favicon.png' %}">
        <script src="{% static 'chat/js/ajax.js' %}"></script>
        <script src="{% static 'chat/js/jquery.min.js' %}"></script>
        <!-- script src="{% static 'chat/js/jquery-ui-custom.min.js' %}"></script -->
        <script src="{% static 'chat/js/jquery.velocity.min.js' %}"></script>
        <script src="{% static 'chat/js/velocity.ui.js' %}"></script>
		<script src="{% static 'chat/js/bootstrap.min.js' %}"></script>
        <script src="{% static 'chat/js/bootstrap-switch.min.js' %}"></script>
        <script src="{% static 'chat/js/alerts.js' %}"></script>
	    <script src="{% static 'chat/js/aes.js' %}"></script>
	    <script src="{% static 'chat/js/jscrypt.js' %}"></script>
	    <script src="{% static 'chat/js/aesprng.js' %}"></script>
	    <script src="{% static 'chat/js/entropy.js' %}"></script>
	    <script src="{% static 'chat/js/md5.js' %}"></script>
        <script src="{% static 'chat/js/sha3.js' %}"></script>
	    <script src="{% static 'chat/js/crlfy.js' %}"></script>
	    <script src="{% static 'chat/js/linkify.js' %}"></script>
	    <script src="{% static 'chat/js/smilify.js' %}"></script>
	    <script src="{% static 'chat/js/jquery.slimscroll.min.js' %}"></script>

	{% endblock %}
	</head>

	<body>
        <div id="alertBox">
        {% if messages %}
            {% for message in messages %}
                {% if message.tags == "error" %}
                    <div class="alert alert-danger alert-dismissable">
                          <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                            <strong>Error!</strong> {{ message }}
                    </div>
                {% elif message.tags == "warning" %}
                    <div class="alert alert-warning alert-dismissable">
                          <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                            <strong>Warning!</strong> {{ message }}
                    </div>
                {% elif message.tags == "info" %}
                    <div class="alert alert-info alert-dismissable">
                          <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                            <strong>Info!</strong> {{ message }}
                    </div>
                {% else %}
                    <div class="alert alert-success alert-dismissable">
                          <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                            <strong>Success!</strong> {{ message }}
                    </div>
                {% endif %}
            {% endfor %}
        {% endif %}
        </div>

        <section id="content">
            {% block content %}
            {% endblock %}
        </section>

        <aside>
        <header>
            {% block header %}

            {% if not user.is_authenticated %}
                <nav>
                    <span><a id="login-button">Log in</a> | <a id="register-button">Register</a></span>
                    <h1><a href="{% url "home" %}">FreeSpeech</a></h1>
                </nav>
            {% else %}
                <nav>
                    <span><span id="user-name">{{ user|truncatechars:20 }}</span> | <a href="{% url "logout" %}">Log out</a></span>
                    <h1><a href="{% url "home" %}">FreeSpeech</a></h1>
                </nav>
            {% endif %}

            <blockquote>
                <p>« Whereof one cannot speak, thereof one must be silent. »<p>
                <small>L.Wittgenstein in <cite title="Source Title">Tractatus</cite></small>
            </blockquote>


            {% block header_option %}
            {% endblock %}

            {% endblock %}
	    </header>


            {% if not user.is_authenticated %}
                <div id="connexion-forms">
                <form id="login-form" class="hidden" action="{% url "login" %}" method="post">
                    {% csrf_token %}
                    <table>
                        <tr>
                            <td class="field-td">
                                <input name="username" type="login" class="form-control" placeholder="Username">
                            </td>
                            <td class="help-td">
                            </td>
                            <td class="submit-td">
                            </td>
                        </tr>
                        <tr>
                            <td class="field-td">
                                <input name="password" type="password" class="form-control" placeholder="Password">
                            </td>
                            <td class="help-td">
                            </td>
                            <td class="submit-td">
                                <input type="submit" class="btn btn-default" value="Log in">
                            </td>
                        </tr>
                    </table>
                </form>

                <form class="formContainer hidden" method="post" action="{% url "register" %}" id="register-form">
                    {% csrf_token %}
                    <table>
                    {% for field in registerForm %}
                        <tr>
                            <td class="field-td">
                                {{ field }}
                            </td>
                            <td class="help-td">
                            </td>
                            <td class="submit-td">
                            </td>
                        </tr>
                    {% endfor %}
                        <tr>
                            <td class="field-td">
                                <input class="form-control" id="beta_key" name="beta_key" placeholder="Beta key" type="text" />
                            </td>
                            <td class="help-td">
                                <a href="#" class="fsp-popover btn btn-info help-block"id="beta_help" rel="popover" data-trigger="hover" data-original-title="Whut ?" data-html="true" data-content="
                                This site is still under development. For now, you need to have an inscription key to be able
                                to register. If you don't have one, you can ask for it at fsp@udtq.fr.
                                ">
                                ?</a>
                            </td>
                            <td class="submit-td">
                                <input class="btn btn-default" type="submit" value="> Register">
                            </td>
                        </tr>
                    </table>
                </form>
                </div>
            {% else %}
                <div id="my-comptoirs">
                    <table class="theader table table-hover">
                        <thead>
                            <td class="td-ciph">Private</td>
                            <td class="td-name">Comptoirs I have joined</td>
                            <td class="td-addr">Address</td>
                            <td class="td-users">Someone's here ?</td>
                        </thead>
                    </table>
                    <div class="hiddenscroll">
                    <div class="scrollable">
                    <table class="table table-hover">
                        <tbody>
                        {% for c,n in user.comptoirs reversed %}
                        <tr id="my-{{ c.id }}">
                            <td class="td-ciph">
                                {% if c.public  %}
                                {% else %}
                                    <span class="glyphicon glyphicon-tag"></span>
                                {% endif %}
                            </td>
                            <td class="td-name">
                                <span class="txt">{{ c.title }}</span>
                                {% if n != 0 %}
                                    <span class="badge active">{{ n }}</span>
                                {% endif %}
                            </td>
                            <td class="td-addr">
                                <a class="cmptr-link" value="{{ c.id }}"
                                    {% url "join_comptoir" c.id %}
                                {% if c.last_message.owner != None %}
                                    class="fsp-tooltip" data-toggle="tooltip" data-original-title="Last message by {{ c.last_message.owner }}<br />({{ c.last_message.date }})" data-html="true" data-placement="left"
                                {% endif %}
                                >{{ c.id }}</a>
                            </td>
                            <td class="td-users"></td>
                        </tr>
                        <!--</p> Hack to remove whitespace between p elements (note HTML5 compliancy)-->
                        {% endfor %}
                        </tbody>
                    </table>
                    </div>
                    </div>
                </div>
            {% endif %}
            {% block footer_option %}

            <div id="aside-panel">
    <table id="options-container" class="hidden">
        <tr id="cpy-url-btn-tr">
            <td class="lbl">
                {# if not public #}
                    <button class="btn btn-default" id="copy-key-button">Copy comptoir key</button>
                {# endif #}
            </td>
            <td class="fld">
                <button class="btn btn-default" id="copy-url-button">Copy comptoir address</button>
            </td>
        </tr>

        <tr id="msg-alert-tr">
            <td class="lbl">
                <label>Sound alert ?</label>
            </td>
            <td class="fld">
                <input id="sound-alert-btn" value=1 name="sound-alert" type="checkbox" unchecked data-off-text="O" data-on-text="I" checked bootstrap-switch-disabled>
            </td>
        </tr>
        <tr id="key-tr">
            <td class="lbl">
                <label class="control-label" for="comptoir-key">Key</label>
            </td>
            <td class="fld">
                <input id="comptoir-key" class="control-label form-control" value="">
            </td>
        </tr>
        <tr id="hash-tr" class="hidden">
            <td class="lbl">
                <label class="control-label" for="comptoir-key-hash">Hash</label>
            </td>
            <td class="fld">
                <input id="comptoir-key-hash" class="form-control" value="" disabled="true">
            </td>
        </tr>
        <tr id="users-connected-tr">
            <td class="lbl">
                <label>Online</label>
            </td>
            <td id="users-connected" class="fld"></td>
        </tr>
    </table>

            </div>
            {% endblock %}
            <footer>
                {% block footer %}
		        {% endblock %}

                <audio id="msgAlert">
                    <source src="{% static 'chat/sounds/msg.ogg' %}" type="audio/ogg">
                </audio>

                <audio id="wizzAlert">
                    <source src="{% static 'chat/sounds/wizz.ogg' %}" type="audio/ogg">
                </audio>

                <audio id="leftAlert">
                    <source src="{% static 'chat/sounds/left.ogg' %}" type="audio/ogg">
                </audio>

                <div id="left-menu">
                    <a href="{% url "about" %}">About</a>
                    •
                    <a href="{% url "report" %}">Report a bug</a>
                    •
                    Version beta {{ version }}
                </div>
            </footer>
        </aside>

        
        
	        <script src="{% static 'chat/js/key_management.js' %}"></script>
	        <script src="{% static 'chat/js/form_check.js' %}"></script>
	        <script src="{% static 'chat/js/ZeroClipboard.min.js' %}"></script>

            {% if user.is_authenticated %}
                {% load socketio_tags %}
                {% socketio %}
	            <script src="{% static 'chat/js/chat.js' %}"></script>
        	    <script src="{% static 'chat/js/scroll.js' %}"></script>
                <script src="{% static 'chat/js/ajax-cmptr.js' %}"></script>
            {% endif %}

	        <script src="{% static 'chat/js/init_page_elements.js' %}"></script>

        {% block additionnal_script %}

        {% endblock %}

	</body>

</html>
